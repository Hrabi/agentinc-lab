@page "/"

<PageTitle>AgenticLab — Dashboard</PageTitle>

<h1>Dashboard</h1>
<p>Welcome to AgenticLab — your local-first agentic AI workbench.</p>

@* Status cards — compact row *@
<div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-top: 24px;">
    <FluentCard Class="stat-card">
        <h3>Ollama Status</h3>
        <div>
            @if (_ollamaChecking)
            {
                <FluentProgressRing Style="width: 24px; height: 24px;" />
            }
            else
            {
                <span class="status-dot @(_ollamaOnline ? "online" : "offline")"></span>
                <span>@(_ollamaOnline ? "Online" : "Offline")</span>
            }
        </div>
    </FluentCard>

    <FluentCard Class="stat-card">
        <h3>Available Models</h3>
        <div class="stat-value">@_availableModels</div>
    </FluentCard>

    <FluentCard Class="stat-card">
        <h3>Model Configs</h3>
        <div class="stat-value">@_modelConfigs</div>
    </FluentCard>

    <FluentCard Class="stat-card">
        <h3>Agent Configs</h3>
        <div class="stat-value">@_agentConfigs</div>
    </FluentCard>

    <FluentCard Class="stat-card">
        <h3>Demo Examples</h3>
        <div class="stat-value">@_exampleCount</div>
    </FluentCard>
</div>

<h2 style="margin-top: 32px;">Quick Start</h2>

<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
    <FluentCard>
        <h3>1. Configure Models</h3>
        <p>Set up Ollama model configurations with custom parameters like temperature and max tokens.</p>
        <FluentAnchor Href="/models" Appearance="Appearance.Accent">Go to Models &rarr;</FluentAnchor>
    </FluentCard>

    <FluentCard>
        <h3>2. Create Agents</h3>
        <p>Create agent instances with a specific model and behavior configuration.</p>
        <FluentAnchor Href="/agents" Appearance="Appearance.Accent">Go to Agents &rarr;</FluentAnchor>
    </FluentCard>

    <FluentCard>
        <h3>3. Test in Playground</h3>
        <p>Chat with your agents, run demo examples, and compare responses side-by-side.</p>
        <FluentAnchor Href="/playground" Appearance="Appearance.Accent">Go to Playground &rarr;</FluentAnchor>
    </FluentCard>

    <FluentCard>
        <h3>4. Compare Results</h3>
        <p>Run the same prompt against multiple agents and compare performance, quality, and speed.</p>
        <FluentAnchor Href="/compare" Appearance="Appearance.Accent">Go to Compare &rarr;</FluentAnchor>
    </FluentCard>
</div>

@if (_ollamaModels.Count > 0)
{
    <h2 style="margin-top: 32px;">Available Ollama Models</h2>
    <FluentDataGrid Items="@_ollamaModels.AsQueryable()" Style="width: 100%;">
        <PropertyColumn Property="@(m => m.Name)" Title="Model" />
        <PropertyColumn Property="@(m => m.Family)" Title="Family" />
        <PropertyColumn Property="@(m => m.ParameterSize)" Title="Parameters" />
        <PropertyColumn Property="@(m => m.QuantizationLevel)" Title="Quantization" />
        <PropertyColumn Property="@(m => m.FormattedSize)" Title="Size" />
    </FluentDataGrid>
}

@code {
    [Inject] private ModelRegistryService ModelRegistry { get; set; } = default!;
    [Inject] private AgentFactoryService AgentFactory { get; set; } = default!;
    [Inject] private ExampleService Examples { get; set; } = default!;

    private bool _ollamaOnline;
    private bool _ollamaChecking = true;
    private int _availableModels;
    private int _modelConfigs;
    private int _agentConfigs;
    private int _exampleCount;
    private List<OllamaModelInfo> _ollamaModels = [];

    protected override async Task OnInitializedAsync()
    {
        _modelConfigs = ModelRegistry.GetConfigs().Count;
        _agentConfigs = AgentFactory.GetConfigs().Count;
        _exampleCount = Examples.GetExamples().Count;

        _ollamaOnline = await ModelRegistry.IsOllamaOnlineAsync();
        _ollamaChecking = false;

        if (_ollamaOnline)
        {
            _ollamaModels = await ModelRegistry.GetAvailableModelsAsync();
            _availableModels = _ollamaModels.Count;
        }
    }
}
