@page "/examples"

<PageTitle>AgenticLab â€” Examples</PageTitle>

<div class="section-header">
    <h1>Demo Examples</h1>
</div>

<p>Built-in scenarios for testing agent capabilities. Click an example to load it into the Playground or Compare view.</p>

<FluentStack Orientation="Orientation.Horizontal" Style="gap: 8px; margin-bottom: 24px;">
    <FluentButton Appearance="@(_selectedCategory is null ? Appearance.Accent : Appearance.Outline)" OnClick="@(() => _selectedCategory = null)">
        All (@_examples.Count)
    </FluentButton>
    @foreach (var category in _categories)
    {
        var cat = category;
        <FluentButton Appearance="@(_selectedCategory == cat ? Appearance.Accent : Appearance.Outline)" OnClick="@(() => _selectedCategory = cat)">
            @cat (@_examples.Count(e => e.Category == cat))
        </FluentButton>
    }
</FluentStack>

<FluentStack Orientation="Orientation.Vertical" Style="gap: 16px;">
    @foreach (var example in FilteredExamples)
    {
        <FluentCard Class="example-card">
            <FluentStack Orientation="Orientation.Horizontal" Style="justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <FluentStack Orientation="Orientation.Horizontal" Style="gap: 8px; align-items: center;">
                    <h3 style="margin: 0; white-space: nowrap;">@example.Title</h3>
                    <FluentBadge>@example.Category</FluentBadge>
                </FluentStack>
                <FluentStack Orientation="Orientation.Horizontal" Style="gap: 4px; flex-shrink: 0;">
                    <FluentButton Appearance="Appearance.Outline" OnClick="@(() => UseInPlayground(example))">
                        <FluentIcon Value="@(new Size16.Chat())" Slot="start" />
                        Playground
                    </FluentButton>
                    <FluentButton Appearance="Appearance.Outline" OnClick="@(() => UseInCompare(example))">
                        <FluentIcon Value="@(new Size16.DataBarVertical())" Slot="start" />
                        Compare
                    </FluentButton>
                </FluentStack>
            </FluentStack>
            <p style="margin: 0;">@example.Description</p>

            @{
                var suggested = GetSuggestedAgents(example);
            }
            @if (suggested.Count > 0)
            {
                <div style="margin-top: 8px;">
                    <span style="font-size: 0.82rem; font-weight: 600; margin-right: 6px;">Suggested agents:</span>
                    <FluentStack Orientation="Orientation.Horizontal" Wrap="true" Style="gap: 4px; display: inline-flex;">
                        @foreach (var agent in suggested)
                        {
                            <FluentBadge Appearance="Appearance.Accent"
                                Style="cursor: pointer; padding: 4px 10px; font-size: 0.78rem;"
                                OnClick="@(() => UseInPlaygroundWithAgent(example, agent))">
                                @agent.DisplayName
                            </FluentBadge>
                        }
                    </FluentStack>
                </div>
            }

            @if (_expandedId == example.Id)
            {
                <div style="margin-top: 16px; border-top: 1px solid var(--neutral-stroke-divider-rest); padding-top: 16px;">
                    <h4>Prompt</h4>
                    <div class="code-block">@example.Prompt</div>

                    <h4 style="margin-top: 12px;">Expected Behavior</h4>
                    <p>@example.ExpectedBehavior</p>

                    <FluentStack Orientation="Orientation.Horizontal" Style="gap: 4px; margin-top: 8px;">
                        @foreach (var tag in example.Tags)
                        {
                            <FluentBadge Appearance="Appearance.Neutral">@tag</FluentBadge>
                        }
                    </FluentStack>
                </div>
            }

            <FluentButton Appearance="Appearance.Stealth" OnClick="@(() => ToggleExpand(example.Id))" Style="margin-top: 8px;">
                @(_expandedId == example.Id ? "Hide Details" : "Show Details")
            </FluentButton>
        </FluentCard>
    }
</FluentStack>

@code {
    [Inject] private ExampleService ExampleSvc { get; set; } = default!;
    [Inject] private AgentFactoryService AgentFactory { get; set; } = default!;
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    private List<DemoExample> _examples = [];
    private List<AgentConfig> _agents = [];
    private List<string> _categories = [];
    private string? _selectedCategory;
    private string? _expandedId;

    private IEnumerable<DemoExample> FilteredExamples =>
        _selectedCategory is null ? _examples : _examples.Where(e => e.Category == _selectedCategory);

    protected override void OnInitialized()
    {
        _examples = ExampleSvc.GetExamples().ToList();
        _categories = ExampleSvc.GetCategories().ToList();
        _agents = AgentFactory.GetConfigs().ToList();
    }

    private List<AgentConfig> GetSuggestedAgents(DemoExample example) =>
        string.IsNullOrEmpty(example.SuggestedAgentType)
            ? []
            : _agents.Where(a => a.AgentType == example.SuggestedAgentType && a.IsActive).ToList();

    private void ToggleExpand(string id)
    {
        _expandedId = _expandedId == id ? null : id;
    }

    private void UseInPlayground(DemoExample example)
    {
        Navigation.NavigateTo($"/playground?exampleId={example.Id}");
    }

    private void UseInPlaygroundWithAgent(DemoExample example, AgentConfig agent)
    {
        Navigation.NavigateTo($"/playground?exampleId={example.Id}&agentId={agent.Id}");
    }

    private void UseInCompare(DemoExample example)
    {
        Navigation.NavigateTo($"/compare?exampleId={example.Id}");
    }
}
